<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Debates - Diplomaq.lol</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
 <script src="https://accounts.google.com/gsi/client" async defer></script>
 <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
 <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
 <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
 <style>
   :root {
     --primary: #1f1d79;
     --primary-light: #a5bcda;
     --secondary: #ff6309;
     --secondary-light: #ff7c30;
     --accent: #c75495;
     --bg-cream: #fdfbf6;
     --text-dark: #454545;
   }
   
   body {
     font-family: 'Outfit', sans-serif;
     background-color: #f0f4fc;
     color: var(--text-dark);
     overflow-x: hidden;
   }
   
   .gradient-bg {
     background: linear-gradient(135deg, #1f1d79 0%, #005791 100%);
   }
   
   .gradient-text {
     background: linear-gradient(90deg, #1f1d79 0%, #c75495 100%);
     -webkit-background-clip: text;
     -webkit-text-fill-color: transparent;
     background-clip: text;
   }
   
   .gradient-button {
     background: linear-gradient(90deg, #ff6309 0%, #ff7c30 100%);
     transition: all 0.3s ease;
   }
   
   .gradient-button:hover {
     background: linear-gradient(90deg, #e86a00 0%, #f16a30 100%);
     transform: translateY(-2px);
     box-shadow: 0 10px 20px rgba(255, 99, 9, 0.2);
   }
   
   .glass-nav {
     background: rgba(255, 255, 255, 0.9);
     backdrop-filter: blur(10px);
     -webkit-backdrop-filter: blur(10px);
     border-bottom: 1px solid rgba(229, 231, 235, 0.5);
   }
   
   .debate-card {
     transition: all 0.3s ease;
   }
   
   .debate-card:hover {
     transform: translateY(-5px);
     box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
   }
   
   .chat-container {
     height: 400px;
     overflow-y: auto;
   }
   
   .chat-message {
     margin-bottom: 12px;
     padding: 10px 15px;
     border-radius: 18px;
     max-width: 80%;
     word-wrap: break-word;
   }
   
   .chat-message.user {
     background-color: #e6f2ff;
     margin-left: auto;
     border-bottom-right-radius: 4px;
   }
   
   .chat-message.other {
     background-color: #f0f0f0;
     margin-right: auto;
     border-bottom-left-radius: 4px;
     }
   
   .chat-message.ai {
     background-color: #f0e6ff;
     margin-right: auto;
     border-bottom-left-radius: 4px;
     border-left: 3px solid #9966cc;
   }
   
   /* Modal styles */
   .modal {
     display: none;
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background-color: rgba(0, 0, 0, 0.5);
     z-index: 1000;
     justify-content: center;
     align-items: center;
   }
   
   .modal.active {
     display: flex;
   }
   
   .modal-content {
     background-color: white;
     padding: 30px;
     border-radius: 12px;
     width: 90%;
     max-width: 600px;
     box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
     animation: modalFadeIn 0.3s;
   }
   
   @keyframes modalFadeIn {
     from { opacity: 0; transform: translateY(-20px); }
     to { opacity: 1; transform: translateY(0); }
   }
   
   /* Loading spinner */
   .spinner {
     width: 40px;
     height: 40px;
     border: 4px solid rgba(0, 0, 0, 0.1);
     border-radius: 50%;
     border-top-color: var(--primary);
     animation: spin 1s ease-in-out infinite;
   }
   
   @keyframes spin {
     to { transform: rotate(360deg); }
   }
   
   /* Tabs */
   .tab {
     cursor: pointer;
     padding: 10px 20px;
     border-bottom: 2px solid transparent;
     transition: all 0.3s ease;
   }
   
   .tab.active {
     border-bottom: 2px solid var(--primary);
     color: var(--primary);
     font-weight: 600;
   }
   
   .tab-content {
     display: none;
   }
   
   .tab-content.active {
     display: block;
   }
   
   /* Dropdown styles */
   .dropdown {
     position: relative;
     display: inline-block;
   }
   
   .dropdown-content {
     display: none;
     position: absolute;
     background-color: white;
     min-width: 200px;
     box-shadow: 0 8px 16px rgba(0,0,0,0.1);
     border-radius: 8px;
     z-index: 1;
     overflow: hidden;
     transform-origin: top center;
     transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
     opacity: 0;
     transform: translateY(-10px);
   }
   
   .dropdown.active .dropdown-content {
     display: block;
     opacity: 1;
     transform: translateY(0);
   }
   
   /* Vote system */
   .vote-button {
     transition: all 0.2s ease;
   }
   
   .vote-button:hover {
     transform: scale(1.1);
   }
   
   .vote-button.voted {
     background-color: #1f1d79;
     color: white;
   }
   
   .vote-count {
     font-weight: bold;
     transition: all 0.3s ease;
   }
   
   .vote-count.highlight {
     color: #ff6309;
     transform: scale(1.2);
   }
   
   /* Timer styles */
   .debate-timer {
     font-family: monospace;
     font-size: 1.2rem;
     font-weight: bold;
   }
   
   .debate-timer.warning {
     color: #ff6309;
   }
   
   .debate-timer.danger {
     color: #ff0000;
     animation: pulse 1s infinite;
   }
   
   @keyframes pulse {
     0% { opacity: 1; }
     50% { opacity: 0.5; }
     100% { opacity: 1; }
   }
   
   /* Badge styles */
   .status-badge {
     display: inline-flex;
     align-items: center;
     padding: 0.25rem 0.75rem;
     border-radius: 9999px;
     font-size: 0.75rem;
     font-weight: 600;
   }
   
   .status-badge.active {
     background-color: #dcfce7;
     color: #166534;
   }
   
   .status-badge.completed {
     background-color: #e0e7ff;
     color: #3730a3;
   }
   
   .status-badge.expired {
     background-color: #fee2e2;
     color: #b91c1c;
   }
 </style>
</head>
<body>
 <!-- Navigation - Matching index.html -->
 <nav class="glass-nav shadow-md sticky top-0 z-50 transition-all duration-300">
   <div class="container mx-auto px-4 py-3">
     <div class="flex justify-between items-center">
       <div class="flex items-center space-x-2">
         <a href="index.html" class="flex items-center">
           <div class="relative">
             <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" class="animate__animated animate__fadeIn">
               <circle cx="24" cy="24" r="18" fill="#1f1d79"/>
               <path d="M24 6C14.0589 6 6 14.0589 6 24C6 33.9411 14.0589 42 24 42C33.9411 42 42 33.9411 42 24C42 14.0589 33.9411 6 24 6Z" fill="#1f1d79"/>
               <path d="M18 18C18 16.0117 19.6117 14.4 21.6 14.4H26.4C28.3883 14.4 30 16.0117 30 18V30C30 31.9883 28.3883 33.6 26.4 33.6H21.6C19.6117 33.6 18 31.9883 18 30V18Z" fill="white"/>
               <path d="M14.4 21.6C14.4 20.2745 15.4745 19.2 16.8 19.2C18.1255 19.2 19.2 20.2745 19.2 21.6V26.4C19.2 27.7255 18.1255 28.8 16.8 28.8C15.4745 28.8 14.4 27.7255 14.4 26.4V21.6Z" fill="white"/>
               <path d="M28.8 21.6C28.8 20.2745 29.8745 19.2 31.2 19.2C32.5255 19.2 33.6 20.2745 33.6 21.6V26.4C33.6 27.7255 32.5255 28.8 31.2 28.8C29.8745 28.8 28.8 27.7255 28.8 26.4V21.6Z" fill="white"/>
               <path d="M34 34L38 38M38 34L34 38" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
             </svg>
             <div class="absolute -bottom-1 -right-1 text-xs font-bold text-[#ff6309]">.lol</div>
           </div>
           <h1 class="text-2xl font-bold text-[#1f1d79] animate__animated animate__fadeIn">Diplomaq</h1>
         </a>
       </div>
       <div class="hidden md:flex space-x-6">
         <!-- Enhanced Navigation Links with Dropdowns -->
         <a href="index.html" class="text-gray-600 hover:text-[#1f1d79] transition">Home</a>
         
         <div class="dropdown" id="debates-dropdown">
           <a href="#" class="text-[#1f1d79] font-medium transition flex items-center">
             Debates
             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
             </svg>
           </a>
           <div class="dropdown-content mt-2">
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition border-b border-gray-100">
               <div class="font-medium text-[#1f1d79]">Live Debates</div>
               <div class="text-xs text-gray-500">Join ongoing discussions</div>
             </a>
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition border-b border-gray-100">
               <div class="font-medium text-[#1f1d79]">Scheduled Debates</div>
               <div class="text-xs text-gray-500">Upcoming debate sessions</div>
             </a>
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition">
               <div class="font-medium text-[#1f1d79]">Create Debate</div>
               <div class="text-xs text-gray-500">Start your own discussion</div>
             </a>
           </div>
         </div>
         
         <div class="dropdown" id="mun-dropdown">
           <a href="#" class="text-gray-600 hover:text-[#1f1d79] transition flex items-center">
             Diplomacy
             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
             </svg>
           </a>
           <div class="dropdown-content mt-2">
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition border-b border-gray-100">
               <div class="font-medium text-[#c75495]">Global Affairs</div>
               <div class="text-xs text-gray-500">International relations simulation</div>
             </a>
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition border-b border-gray-100">
               <div class="font-medium text-[#c75495]">Crisis Management</div>
               <div class="text-xs text-gray-500">Respond to global challenges</div>
             </a>
             <a href="#" class="block px-4 py-3 hover:bg-gray-50 transition">
               <div class="font-medium text-[#c75495]">Model UN</div>
               <div class="text-xs text-gray-500">MUN experience</div>
             </a>
           </div>
         </div>
         
         <a href="profile.html" class="text-gray-600 hover:text-[#1f1d79] transition">Profile</a>
       </div>
       <div>
         <!-- User is signed in -->
         <div id="user-signed-in" class="hidden">
           <div class="flex items-center space-x-4">
             <div class="flex items-center space-x-2">
               <img id="user-avatar" src="/placeholder.svg" alt="User Avatar" class="w-8 h-8 rounded-full">
               <span id="user-name" class="text-sm font-medium hidden md:inline"></span>
             </div>
             <div class="flex space-x-2">
               <a href="profile.html" class="px-3 py-1.5 text-sm border border-[#1f1d79] text-[#1f1d79] font-medium rounded-md hover:bg-[#1f1d79] hover:text-white transition">Profile</a>
               <a href="#" id="logout-btn" class="px-3 py-1.5 text-sm border border-[#1f1d79] text-[#1f1d79] font-medium rounded-md hover:bg-[#1f1d79] hover:text-white transition">Sign Out</a>
             </div>
           </div>
         </div>
         
         <!-- User is not signed in -->
         <div id="user-not-signed-in">
           <a href="signin.html" class="px-4 py-2 border-2 border-[#1f1d79] text-[#1f1d79] font-medium rounded-md hover:bg-[#1f1d79] hover:text-white transition">Sign In</a>
         </div>
       </div>
       <!-- Mobile menu button -->
       <div class="md:hidden">
         <button id="mobile-menu-button" class="p-2 rounded-md text-gray-600 hover:text-[#1f1d79] hover:bg-gray-100 transition">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
           </svg>
         </button>
       </div>
     </div>
     
     <!-- Mobile menu -->
     <div id="mobile-menu" class="md:hidden hidden mt-4 animate__animated animate__fadeIn">
       <a href="index.html" class="block py-2 text-gray-600 hover:text-[#1f1d79] transition">Home</a>
       <a href="#" class="block py-2 text-[#1f1d79] font-medium transition">Debates</a>
       <a href="#" class="block py-2 text-gray-600 hover:text-[#1f1d79] transition">Diplomacy</a>
       <a href="profile.html" class="block py-2 text-gray-600 hover:text-[#1f1d79] transition">Profile</a>
     </div>
   </div>
 </nav>
 
 <!-- Main Content -->
 <main class="container mx-auto px-4 py-8">
   <!-- Header -->
   <div class="mb-8">
     <h1 class="text-3xl font-bold text-[#1f1d79] mb-2">UN Debates</h1>
     <p class="text-gray-600">Join or create debates on global issues and practice your diplomatic skills</p>
   </div>
   
   <!-- Tabs -->
   <div class="flex border-b border-gray-200 mb-8">
     <div class="tab active" data-tab="debates">Active Debates</div>
     <div class="tab" data-tab="matchmaking">Matchmaking</div>
   </div>
   
   <!-- Tab Content -->
   <div id="debates-tab" class="tab-content active">
     <!-- Auth Check -->
     <div id="auth-check" class="bg-white rounded-xl shadow-md p-8 text-center mb-8 hidden">
       <h2 class="text-2xl font-bold text-[#1f1d79] mb-4">Sign In to Join Debates</h2>
       <p class="text-gray-600 mb-6">You need to sign in to join debates and participate in discussions.</p>
       <a href="signin.html" class="px-6 py-3 gradient-button text-white font-semibold rounded-md">Sign In</a>
     </div>
     
     <!-- Alert for errors -->
     <div id="error-alert" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 hidden" role="alert">
       <strong class="font-bold">Error: </strong>
       <span id="error-message" class="block sm:inline"></span>
       <span id="error-dismiss" class="absolute top-0 bottom-0 right-0 px-4 py-3">
         <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Close</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
       </span>
     </div>
     
     <!-- Filter Section -->
     <div class="bg-white rounded-xl shadow-md p-6 mb-8">
       <div class="flex flex-col md:flex-row gap-4">
         <div class="flex-1">
           <label for="topic-filter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Topic</label>
           <input type="text" id="topic-filter" placeholder="Search topics..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
         </div>
         <div>
           <label for="council-filter" class="block text-sm font-medium text-gray-700 mb-1">Council</label>
           <select id="council-filter" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
             <option value="all">All Councils</option>
             <option value="UNSC">UN Security Council (UNSC)</option>
             <option value="UNGA">UN General Assembly (UNGA)</option>
             <option value="UNHRC">UN Human Rights Council (UNHRC)</option>
             <option value="ECOSOC">UN Economic and Social Council (ECOSOC)</option>
           </select>
         </div>
         <div class="self-end">
           <button id="apply-filters-btn" class="px-6 py-2 gradient-button text-white font-semibold rounded-md">Apply Filters</button>
         </div>
       </div>
     </div>
     
     <!-- Debates List -->
     <div id="debates-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       <!-- Debates will be loaded here -->
       <div class="flex justify-center items-center col-span-full py-12">
         <div class="spinner"></div>
       </div>
     </div>
     
     <!-- Create Debate Button -->
     <div class="fixed bottom-6 right-6">
       <button id="create-debate-btn" class="gradient-button text-white font-semibold rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:shadow-xl">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
         </svg>
       </button>
     </div>
   </div>
   
   <!-- Matchmaking Tab -->
   <div id="matchmaking-tab" class="tab-content">
     <div class="bg-white rounded-xl shadow-md p-8 mb-8">
       <h2 class="text-2xl font-bold text-[#1f1d79] mb-4">Find a Debate Partner</h2>
       <p class="text-gray-600 mb-6">Get matched with another user to start a debate on a topic of your choice.</p>
       
       <!-- Matchmaking Form -->
       <div id="matchmaking-form" class="space-y-6">
         <div>
           <label for="council-select" class="block text-sm font-medium text-gray-700 mb-1">Select Council</label>
           <select id="council-select" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
             <option value="">-- Select Council --</option>
             <option value="UNSC">UN Security Council (UNSC)</option>
             <option value="UNGA">UN General Assembly (UNGA)</option>
             <option value="UNHRC">UN Human Rights Council (UNHRC)</option>
             <option value="ECOSOC">UN Economic and Social Council (ECOSOC)</option>
           </select>
         </div>
         
         <div>
           <label for="topic-select" class="block text-sm font-medium text-gray-700 mb-1">Select Topic (Optional)</label>
           <input type="text" id="topic-select" placeholder="Enter a topic..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
           <p class="text-sm text-gray-500 mt-1">If you don't select a topic, you'll be matched with anyone in the same council.</p>
         </div>
         
         <div class="flex flex-col md:flex-row gap-4">
           <button id="join-queue-btn" class="flex-1 py-3 gradient-button text-white font-semibold rounded-md">Join Standard Queue</button>
           <button id="quick-match-btn" class="flex-1 py-3 bg-[#1f1d79] text-white font-semibold rounded-md hover:bg-[#161560] transition">Quick Match</button>
         </div>
       </div>
       
       <!-- Queue Status -->
       <div id="queue-status" class="hidden space-y-6 mt-6">
         <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
           <h3 class="text-lg font-semibold text-blue-800 mb-2">You're in the Queue</h3>
           <p class="text-blue-700">
             You are position <span id="queue-position" class="font-bold">1</span> of <span id="queue-size" class="font-bold">1</span> in the queue for <span id="queue-council" class="font-bold">UNSC</span>.
           </p>
           <p class="text-blue-700 mt-2">We'll notify you when a match is found.</p>
           <div class="mt-4">
             <div class="w-full bg-blue-200 rounded-full h-2">
               <div id="queue-timer" class="bg-blue-600 h-2 rounded-full" style="width: 100%"></div>
             </div>
             <p class="text-xs text-blue-600 mt-1">Matchmaking will timeout in <span id="queue-time-left">2:00</span></p>
           </div>
         </div>
         
         <div>
           <button id="leave-queue-btn" class="w-full py-3 border border-red-500 text-red-500 font-semibold rounded-md hover:bg-red-500 hover:text-white transition">Leave Queue</button>
         </div>
       </div>
       
       <!-- Quick Match Status -->
       <div id="quick-match-status" class="hidden space-y-6 mt-6">
         <div class="bg-indigo-50 border border-indigo-200 rounded-md p-4">
           <h3 class="text-lg font-semibold text-indigo-800 mb-2">Quick Match in Progress</h3>
           <p class="text-indigo-700">
             Looking for a debate partner for <span id="quick-match-council" class="font-bold">UNSC</span>.
           </p>
           <p class="text-indigo-700 mt-2">This will automatically refresh to check for matches.</p>
           <div class="mt-4 flex items-center justify-center">
             <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
           </div>
           <div class="mt-4">
             <div class="w-full bg-indigo-200 rounded-full h-2">
               <div id="quick-match-timer" class="bg-indigo-600 h-2 rounded-full" style="width: 100%"></div>
             </div>
             <p class="text-xs text-indigo-600 mt-1">Quick match will timeout in <span id="quick-match-time-left">2:00</span></p>
           </div>
         </div>
         
         <div>
           <button id="cancel-quick-match-btn" class="w-full py-3 border border-red-500 text-red-500 font-semibold rounded-md hover:bg-red-500 hover:text-white transition">Cancel Quick Match</button>
         </div>
       </div>
     </div>
     
     <!-- AI Debate Option -->
     <div class="bg-white rounded-xl shadow-md p-8">
       <h2 class="text-2xl font-bold text-[#1f1d79] mb-4">Practice with AI</h2>
       <p class="text-gray-600 mb-6">Can't find a match? Practice your debating skills with our AI diplomat.</p>
       
       <div class="flex flex-col md:flex-row gap-4">
         <select id="ai-council-select" class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
           <option value="">-- Select Council --</option>
           <option value="UNSC">UN Security Council (UNSC)</option>
           <option value="UNGA">UN General Assembly (UNGA)</option>
           <option value="UNHRC">UN Human Rights Council (UNHRC)</option>
           <option value="ECOSOC">UN Economic and Social Council (ECOSOC)</option>
         </select>
         
         <button id="start-ai-debate-btn" class="px-6 py-2 gradient-button text-white font-semibold rounded-md">Start AI Debate</button>
       </div>
       
       <div id="ai-subscription-notice" class="mt-4 text-sm text-gray-500">
         <p>AI debates are available to Pro, Elite, and Institutional subscribers only.</p>
         <a href="subscriptions.html" class="text-[#1f1d79] hover:underline">Upgrade your subscription</a>
       </div>
     </div>
   </div>
 </main>
 
 <!-- Create Debate Modal -->
 <div id="create-debate-modal" class="modal">
   <div class="modal-content">
     <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold text-[#1f1d79]">Create a New Debate</h3>
       <button id="close-create-modal" class="text-gray-500 hover:text-gray-700">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg>
       </button>
     </div>
     
     <form id="create-debate-form" class="space-y-4">
       <div>
         <label for="debate-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
         <input type="text" id="debate-title" name="title" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
       </div>
       
       <div>
         <label for="debate-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
         <textarea id="debate-description" name="description" rows="3" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]"></textarea>
       </div>
       
       <div>
         <label for="debate-council" class="block text-sm font-medium text-gray-700 mb-1">UN Council</label>
         <select id="debate-council" name="council" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
           <option value="">-- Select Council --</option>
           <option value="UNSC">UN Security Council (UNSC)</option>
           <option value="UNGA">UN General Assembly (UNGA)</option>
           <option value="UNHRC">UN Human Rights Council (UNHRC)</option>
           <option value="ECOSOC">UN Economic and Social Council (ECOSOC)</option>
         </select>
       </div>
       
       <div>
         <label for="debate-topic" class="block text-sm font-medium text-gray-700 mb-1">Topic</label>
         <input type="text" id="debate-topic" name="topic" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]" placeholder="e.g., Climate Change, Nuclear Disarmament, Human Rights">
       </div>
       
       <div class="pt-4">
         <button type="submit" id="submit-debate-btn" class="w-full py-3 gradient-button text-white font-semibold rounded-md">Create Debate</button>
       </div>
     </form>
   </div>
 </div>
 
 <!-- Debate View Modal -->
 <div id="debate-view-modal" class="modal">
   <div class="modal-content max-w-4xl">
     <div class="flex justify-between items-center mb-4">
       <h3 id="debate-view-title" class="text-2xl font-bold text-[#1f1d79]">Debate Title</h3>
       <button id="close-debate-view-modal" class="text-gray-500 hover:text-gray-700">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg>
       </button>
     </div>
     
     <div class="mb-4">
       <p id="debate-view-description" class="text-gray-600">Debate description goes here.</p>
       <div class="flex items-center mt-2">
         <span class="text-sm text-gray-500">Council:</span>
         <span id="debate-view-council" class="ml-2 text-sm font-medium text-[#1f1d79]">UNSC</span>
       </div>
       <div class="flex items-center mt-1">
         <span class="text-sm text-gray-500">Topic:</span>
         <span id="debate-view-topic" class="ml-2 text-sm font-medium text-[#1f1d79]">Climate Change</span>
       </div>
       <div class="flex items-center justify-between mt-3">
         <div class="flex items-center">
           <span class="text-sm text-gray-500">Status:</span>
           <span id="debate-view-status" class="ml-2 status-badge active">Active</span>
         </div>
         <div class="debate-timer" id="debate-timer">35:00</div>
       </div>
     </div>
     
     <div class="border-t border-gray-200 pt-4 mb-4">
       <h4 class="text-lg font-semibold mb-2">Participants</h4>
       <div id="debate-view-participants" class="flex flex-wrap gap-2">
         <!-- Participants will be loaded here -->
       </div>
     </div>
     
     <!-- Voting Section -->
     <div id="debate-voting-section" class="border-t border-gray-200 pt-4 mb-4 hidden">
       <h4 class="text-lg font-semibold mb-2">Vote for Winner</h4>
       <p class="text-sm text-gray-600 mb-3">Who made the most compelling arguments in this debate?</p>
       <div id="voting-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <!-- Voting options will be loaded here -->
       </div>
     </div>
     
     <div id="debate-join-section" class="mb-4">
       <button id="join-debate-btn" class="w-full py-3 gradient-button text-white font-semibold rounded-md">Join Debate</button>
     </div>
     
     <div id="debate-chat-section" class="hidden">
       <div class="border-t border-gray-200 pt-4">
         <h4 class="text-lg font-semibold mb-2">Discussion</h4>
         <div id="debate-chat-container" class="chat-container border border-gray-200 rounded-md p-4 mb-4">
           <!-- Chat messages will be loaded here -->
           <div class="text-center text-gray-500 py-4">
             No messages yet. Be the first to contribute to this debate!
           </div>
         </div>
         
         <form id="chat-form" class="flex gap-2">
           <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]">
           <button type="submit" class="px-4 py-2 gradient-button text-white font-semibold rounded-md">Send</button>
         </form>
         
         <div id="ai-assist-section" class="mt-4 hidden">
           <button id="ai-assist-btn" class="w-full py-2 border border-[#1f1d79] text-[#1f1d79] font-medium rounded-md hover:bg-[#1f1d79] hover:text-white transition">
             Ask AI for Assistance
           </button>
         </div>
         
         <div id="leave-debate-section" class="mt-4">
           <button id="leave-debate-btn" class="w-full py-2 border border-red-500 text-red-500 font-medium rounded-md hover:bg-red-500 hover:text-white transition">
             Leave Debate
           </button>
         </div>
         
         <div id="save-debate-section" class="mt-4 hidden">
           <button id="save-debate-btn" class="w-full py-2 border border-green-500 text-green-500 font-medium rounded-md hover:bg-green-500 hover:text-white transition">
             Save Debate to Profile
           </button>
         </div>
       </div>
     </div>
   </div>
 </div>
 
 <!-- AI Assist Modal -->
 <div id="ai-assist-modal" class="modal">
   <div class="modal-content">
     <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold text-[#1f1d79]">AI Assistance</h3>
       <button id="close-ai-assist-modal" class="text-gray-500 hover:text-gray-700">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg>
       </button>
     </div>
     
     <form id="ai-assist-form" class="space-y-4">
       <div>
         <label for="ai-prompt" class="block text-sm font-medium text-gray-700 mb-1">What would you like help with?</label>
         <textarea id="ai-prompt" rows="3" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1f1d79]" placeholder="e.g., Help me draft a response about climate change solutions"></textarea>
       </div>
       
       <div class="pt-4">
         <button type="submit" id="submit-ai-prompt-btn" class="w-full py-3 gradient-button text-white font-semibold rounded-md">Get AI Response</button>
       </div>
     </form>
     
     <div id="ai-response-container" class="hidden mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
       <h4 class="text-lg font-semibold text-[#1f1d79] mb-2">AI Response</h4>
       <p id="ai-response-text" class="text-gray-700"></p>
       
       <div class="mt-4 flex justify-end">
         <button id="use-ai-response-btn" class="px-4 py-2 gradient-button text-white font-semibold rounded-md">Use This Response</button>
       </div>
     </div>
   </div>
 </div>

 <!-- Leave Debate Confirmation Modal -->
 <div id="leave-debate-confirm-modal" class="modal">
   <div class="modal-content max-w-md">
     <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold text-[#1f1d79]">Leave Debate?</h3>
       <button id="close-leave-confirm-modal" class="text-gray-500 hover:text-gray-700">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg>
       </button>
     </div>
     
     <p class="text-gray-600 mb-6">Are you sure you want to leave this debate? You can save it to your profile before leaving.</p>
     
     <div class="flex flex-col gap-3">
       <button id="confirm-leave-btn" class="w-full py-3 border border-red-500 text-red-500 font-medium rounded-md hover:bg-red-500 hover:text-white transition">
         Leave Without Saving
       </button>
       <button id="save-and-leave-btn" class="w-full py-3 gradient-button text-white font-semibold rounded-md">
         Save to Profile and Leave
       </button>
       <button id="cancel-leave-btn" class="w-full py-3 border border-gray-300 text-gray-700 font-medium rounded-md hover:bg-gray-100 transition">
         Cancel
       </button>
     </div>
   </div>
 </div>
 
 <script>
   document.addEventListener('DOMContentLoaded', function() {
     // Check if user is logged in
     const userToken = localStorage.getItem('userToken');
     const userEmail = localStorage.getItem('userEmail');
     const userName = localStorage.getItem('userName');
     const userUsername = localStorage.getItem('userUsername');
     const userAvatar = localStorage.getItem('userAvatar');
     
     // Set user ID in localStorage for Pusher
     if (userEmail) {
       fetch(`/api/auth/verify`, {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({ email: userEmail })
       })
       .then(res => res.json())
       .then(data => {
         if (data.valid) {
           localStorage.setItem('userId', data.id);
         }
       })
       .catch(error => console.error('Error verifying user:', error));
     }
     
     if (userToken && userEmail) {
       // User is logged in, show signed in UI
       document.getElementById('user-signed-in').classList.remove('hidden');
       document.getElementById('user-not-signed-in').classList.add('hidden');
       document.getElementById('auth-check').classList.add('hidden');
       
       // Set user info
       if (userUsername) {
         document.getElementById('user-name').textContent = userUsername;
       } else if (userName) {
         document.getElementById('user-name').textContent = userName;
       } else {
         document.getElementById('user-name').textContent = userEmail;
       }
       
       if (userAvatar) {
         document.getElementById('user-avatar').src = userAvatar;
       }
       
       // Handle logout
       document.getElementById('logout-btn').addEventListener('click', function(e) {
         e.preventDefault();
         
         // Clear user data from localStorage
         localStorage.removeItem('userToken');
         localStorage.removeItem('userEmail');
         localStorage.removeItem('userName');
         localStorage.removeItem('userUsername');
         localStorage.removeItem('userAvatar');
         localStorage.removeItem('userId');
         
         // Reload the page
         window.location.reload();
       });
     } else {
       // User is not logged in, show sign in UI
       document.getElementById('user-signed-in').classList.add('hidden');
       document.getElementById('user-not-signed-in').classList.remove('hidden');
       document.getElementById('auth-check').classList.remove('hidden');
     }
     
     // Mobile menu toggle
     const mobileMenuButton = document.getElementById('mobile-menu-button');
     const mobileMenu = document.getElementById('mobile-menu');
     
     mobileMenuButton.addEventListener('click', function() {
       mobileMenu.classList.toggle('hidden');
     });
     
     // Dropdown functionality
     const dropdowns = document.querySelectorAll('.dropdown');
     
     // For desktop - click to toggle
     dropdowns.forEach(dropdown => {
       const trigger = dropdown.querySelector('a');
       if (trigger) {
         trigger.addEventListener('click', function(e) {
           // First prevent the default behavior to avoid navigation
           e.preventDefault();
           
           // Close all other dropdowns
           dropdowns.forEach(d => {
             if (d !== dropdown) {
               d.classList.remove('active');
             }
           });
           
           // Toggle current dropdown
           dropdown.classList.toggle('active');
           e.stopPropagation();
         });
       }
     });
     
     // Close dropdowns when clicking elsewhere
     document.addEventListener('click', function() {
       dropdowns.forEach(dropdown => {
         dropdown.classList.remove('active');
       });
     });
     
     // Tab switching
     const tabs = document.querySelectorAll('.tab');
     const tabContents = document.querySelectorAll('.tab-content');
     
     tabs.forEach(tab => {
       tab.addEventListener('click', function() {
         const tabId = this.getAttribute('data-tab');
         
         // Remove active class from all tabs and tab contents
         tabs.forEach(t => t.classList.remove('active'));
         tabContents.forEach(c => c.classList.remove('active'));
         
         // Add active class to clicked tab and corresponding content
         this.classList.add('active');
         document.getElementById(`${tabId}-tab`).classList.add('active');
       });
     });
     
     // Load debates
     loadDebates();
     
     // Set up auto-refresh for debates (every 4 seconds)
     setInterval(loadDebates, 4000);
     
     // Filter functionality
     document.getElementById('apply-filters-btn').addEventListener('click', function() {
       loadDebates();
     });
     
     // Create debate modal
     const createDebateBtn = document.getElementById('create-debate-btn');
     const createDebateModal = document.getElementById('create-debate-modal');
     const closeCreateModal = document.getElementById('close-create-modal');
     
     createDebateBtn.addEventListener('click', function() {
       if (!userToken || !userEmail) {
         alert('Please sign in to create a debate.');
         window.location.href = 'signin.html';
         return;
       }
       
       createDebateModal.classList.add('active');
     });
     
     closeCreateModal.addEventListener('click', function() {
       createDebateModal.classList.remove('active');
     });
     
     // Create debate form submission
     const createDebateForm = document.getElementById('create-debate-form');
     
     createDebateForm.addEventListener('submit', function(e) {
       e.preventDefault();
       
       const title = document.getElementById('debate-title').value;
       const description = document.getElementById('debate-description').value;
       const council = document.getElementById('debate-council').value;
       const topic = document.getElementById('debate-topic').value;
       
       if (!title || !description || !council || !topic) {
         alert('Please fill in all fields.');
         return;
       }
       
       // Check for curse words
       if (containsCurseWords(title) || containsCurseWords(description) || containsCurseWords(topic)) {
         alert('Please avoid using inappropriate language in your debate.');
         return;
       }
       
       // Disable submit button
       const submitBtn = document.getElementById('submit-debate-btn');
       submitBtn.disabled = true;
       submitBtn.innerHTML = '<span class="spinner inline-block mr-2"></span> Creating...';
       
       // Create debate
       fetch('/api/debates', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           title,
           description,
           council,
           topic,
           email: userEmail
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Close modal
           createDebateModal.classList.remove('active');
           
           // Reset form
           createDebateForm.reset();
           
           // Reload debates
           loadDebates();
           
           // Open the debate view
           openDebateView(data.debate);
         } else {
           alert('Error: ' + (data.error || 'Failed to create debate'));
         }
         
         // Re-enable submit button
         submitBtn.disabled = false;
         submitBtn.innerHTML = 'Create Debate';
       })
       .catch(error => {
         console.error('Error creating debate:', error);
         alert('An error occurred. Please try again later.');
         
         // Re-enable submit button
         submitBtn.disabled = false;
         submitBtn.innerHTML = 'Create Debate';
       });
     });
     
     // Debate view modal
     const debateViewModal = document.getElementById('debate-view-modal');
     const closeDebateViewModal = document.getElementById('close-debate-view-modal');
     
     closeDebateViewModal.addEventListener('click', function() {
       debateViewModal.classList.remove('active');
       
       // Clean up resources
       cleanupDebateResources();
     });
     
     // AI assist modal
     const aiAssistModal = document.getElementById('ai-assist-modal');
     const closeAiAssistModal = document.getElementById('close-ai-assist-modal');
     
     closeAiAssistModal.addEventListener('click', function() {
       aiAssistModal.classList.remove('active');
     });
     
     // Leave debate confirmation modal
     const leaveDebateConfirmModal = document.getElementById('leave-debate-confirm-modal');
     const closeLeaveConfirmModal = document.getElementById('close-leave-confirm-modal');
     const cancelLeaveBtn = document.getElementById('cancel-leave-btn');
     
     closeLeaveConfirmModal.addEventListener('click', function() {
       leaveDebateConfirmModal.classList.remove('active');
     });
     
     cancelLeaveBtn.addEventListener('click', function() {
       leaveDebateConfirmModal.classList.remove('active');
     });
     
     // AI assist form submission
     const aiAssistForm = document.getElementById('ai-assist-form');
     
     aiAssistForm.addEventListener('submit', function(e) {
       e.preventDefault();
       
       const prompt = document.getElementById('ai-prompt').value;
       
       if (!prompt) {
         alert('Please enter a prompt.');
         return;
       }
       
       // Disable submit button
       const submitBtn = document.getElementById('submit-ai-prompt-btn');
       submitBtn.disabled = true;
       submitBtn.innerHTML = '<span class="spinner inline-block mr-2"></span> Generating...';
       
       // Get current debate ID
       const debateId = document.getElementById('debate-view-modal').getAttribute('data-debate-id');
       
       // Get AI response
       fetch(`/api/debates/${debateId}/ai-message`, {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           prompt,
           email: userEmail
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Show AI response
           document.getElementById('ai-response-container').classList.remove('hidden');
           document.getElementById('ai-response-text').textContent = data.message.content;
           
           // Set up "Use This Response" button
           document.getElementById('use-ai-response-btn').onclick = function() {
             document.getElementById('chat-input').value = data.message.content;
             aiAssistModal.classList.remove('active');
           };
         } else {
           alert('Error: ' + (data.error || 'Failed to get AI response'));
         }
         
         // Re-enable submit button
         submitBtn.disabled = false;
         submitBtn.innerHTML = 'Get AI Response';
       })
       .catch(error => {
         console.error('Error getting AI response:', error);
         alert('An error occurred. Please try again later.');
         
         // Re-enable submit button
         submitBtn.disabled = false;
         submitBtn.innerHTML = 'Get AI Response';
       });
     });
     
     // Matchmaking functionality
     const joinQueueBtn = document.getElementById('join-queue-btn');
     const leaveQueueBtn = document.getElementById('leave-queue-btn');
     const matchmakingForm = document.getElementById('matchmaking-form');
     const queueStatus = document.getElementById('queue-status');
     
     joinQueueBtn.addEventListener('click', function() {
       if (!userToken || !userEmail) {
         alert('Please sign in to join the matchmaking queue.');
         window.location.href = 'signin.html';
         return;
       }
       
       const council = document.getElementById('council-select').value;
       const topic = document.getElementById('topic-select').value;
       
       if (!council) {
         alert('Please select a council.');
         return;
       }
       
       // Disable button
       joinQueueBtn.disabled = true;
       joinQueueBtn.innerHTML = '<span class="spinner inline-block mr-2"></span> Joining...';
       
       // Join queue
       fetch('/api/matchmaking/join', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           email: userEmail,
           council,
           topic
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Hide form and show queue status
           matchmakingForm.classList.add('hidden');
           queueStatus.classList.remove('hidden');
           
           // Update queue info
           document.getElementById('queue-council').textContent = council;
           
           // Start queue timer (5 minutes)
           startQueueTimer(5 * 60);
           
           // If already matched, open the debate
           if (data.matched && data.debate) {
             openDebateView(data.debate);
           } else {
             // Check queue status periodically
             checkQueueStatus();
           }
         } else {
           alert('Error: ' + (data.error || 'Failed to join queue'));
           
           // Re-enable button
           joinQueueBtn.disabled = false;
           joinQueueBtn.innerHTML = 'Join Queue';
         }
       })
       .catch(error => {
         console.error('Error joining queue:', error);
         alert('An error occurred. Please try again later.');
         
         // Re-enable button
         joinQueueBtn.disabled = false;
         joinQueueBtn.innerHTML = 'Join Queue';
       });
     });
     
     leaveQueueBtn.addEventListener('click', function() {
       // Leave queue
       fetch('/api/matchmaking/leave', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           email: userEmail
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Show form and hide queue status
           matchmakingForm.classList.remove('hidden');
           queueStatus.classList.add('hidden');
           
           // Reset form
           document.getElementById('council-select').value = '';
           document.getElementById('topic-select').value = '';
           
           // Re-enable join button
           joinQueueBtn.disabled = false;
           joinQueueBtn.innerHTML = 'Join Queue';
           
           // Clear queue timer
           clearQueueTimer();
         } else {
           alert('Error: ' + (data.error || 'Failed to leave queue'));
         }
       })
       .catch(error => {
         console.error('Error leaving queue:', error);
         alert('An error occurred. Please try again later.');
       });
     });
     
     // Queue timer variables
     let queueTimerInterval;
     let queueTimeLeft;
     
     // Start queue timer
     function startQueueTimer(seconds) {
       queueTimeLeft = seconds;
       updateQueueTimer();
       
       queueTimerInterval = setInterval(() => {
         queueTimeLeft--;
         updateQueueTimer();
         
         if (queueTimeLeft <= 0) {
           clearInterval(queueTimerInterval);
           
           // Auto-leave queue after timeout
           leaveQueueBtn.click();
           alert('Matchmaking timed out. Please try again.');
         }
       }, 1000);
     }
     
     // Update queue timer display
     function updateQueueTimer() {
       const minutes = Math.floor(queueTimeLeft / 60);
       const seconds = queueTimeLeft % 60;
       document.getElementById('queue-time-left').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
       
       // Update progress bar
       const percentage = (queueTimeLeft / (5 * 60)) * 100;
       document.getElementById('queue-timer').style.width = `${percentage}%`;
     }
     
     // Clear queue timer
     function clearQueueTimer() {
       clearInterval(queueTimerInterval);
     }
     
     // Check queue status
     function checkQueueStatus() {
       fetch(`/api/matchmaking/status?email=${encodeURIComponent(userEmail)}`)
         .then(res => res.json())
         .then(data => {
           if (data.inQueue) {
             // Update queue position
             document.getElementById('queue-position').textContent = data.queuePosition;
             document.getElementById('queue-size').textContent = data.queueSize;
             
             // Check again in 5 seconds
             setTimeout(checkQueueStatus, 5000);
           } else if (data.matched && data.debate) {
             // Clear queue timer
             clearQueueTimer();
             
             // Open the debate
             openDebateView(data.debate);
             
             // Show form and hide queue status
             matchmakingForm.classList.remove('hidden');
             queueStatus.classList.add('hidden');
             
             // Re-enable join button
             joinQueueBtn.disabled = false;
             joinQueueBtn.innerHTML = 'Join Queue';
           }
         })
         .catch(error => {
           console.error('Error checking queue status:', error);
           
           // Check again in 5 seconds
           setTimeout(checkQueueStatus, 5000);
         });
     }
     
     // Functions
     function loadDebates() {
       const debatesList = document.getElementById('debates-list');
       
       // Get filter values
       const topicFilter = document.getElementById('topic-filter').value.toLowerCase();
       const councilFilter = document.getElementById('council-filter').value;
       
       // Show loading spinner
       debatesList.innerHTML = `
         <div class="flex justify-center items-center col-span-full py-12">
           <div class="spinner"></div>
         </div>
       `;
       
       // Fetch debates
       fetch('/api/debates')
         .then(res => res.json())
         .then(data => {
           // Filter debates
           let filteredDebates = data.debates;
           
           if (councilFilter !== 'all') {
             filteredDebates = filteredDebates.filter(debate => debate.council === councilFilter);
           }
           
           if (topicFilter) {
             filteredDebates = filteredDebates.filter(debate => 
               debate.title.toLowerCase().includes(topicFilter) || 
               debate.description.toLowerCase().includes ||
               debate.description.toLowerCase().includes(topicFilter) ||
               (debate.topic && debate.topic.toLowerCase().includes(topicFilter))
             );
           }
           
           // Render debates
           if (filteredDebates.length > 0) {
             debatesList.innerHTML = filteredDebates.map(debate => {
               // Calculate status badge
               let statusBadge = '';
               if (debate.status === 'active') {
                 statusBadge = '<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>';
               } else if (debate.status === 'completed') {
                 statusBadge = '<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Completed</span>';
               } else if (debate.status === 'expired') {
                 statusBadge = '<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Expired</span>';
               }
               
               return `
                 <div class="debate-card bg-white rounded-xl shadow-md overflow-hidden">
                   <div class="p-6">
                     <div class="flex justify-between items-start mb-2">
                       <h3 class="text-xl font-bold text-[#1f1d79]">${debate.title}</h3>
                       ${statusBadge}
                     </div>
                     <p class="text-gray-600 mb-4">${debate.description}</p>
                     <div class="flex items-center justify-between mb-2">
                       <span class="text-sm font-medium text-[#1f1d79]">${debate.council}</span>
                       <span class="text-sm text-gray-500">${debate.participants ? debate.participants.length : 0} participants</span>
                     </div>
                     <div class="mb-4">
                       <span class="text-sm text-gray-500">Topic: ${debate.topic || 'General'}</span>
                     </div>
                     <button class="view-debate-btn w-full py-2 border border-[#1f1d79] text-[#1f1d79] font-medium rounded-md hover:bg-[#1f1d79] hover:text-white transition" data-debate-id="${debate.id}">View Debate</button>
                   </div>
                 </div>
               `;
             }).join('');
             
             // Add event listeners to view debate buttons
             document.querySelectorAll('.view-debate-btn').forEach(btn => {
               btn.addEventListener('click', function() {
                 const debateId = this.getAttribute('data-debate-id');
                 const debate = filteredDebates.find(d => d.id === debateId);
                 
                 if (debate) {
                   openDebateView(debate);
                 }
               });
             });
           } else {
             debatesList.innerHTML = `
               <div class="col-span-full text-center py-12">
                 <p class="text-gray-500 mb-4">No debates found matching your filters.</p>
                 <button id="create-first-debate-btn" class="px-6 py-3 gradient-button text-white font-semibold rounded-md">Create Your First Debate</button>
               </div>
             `;
             
             document.getElementById('create-first-debate-btn').addEventListener('click', function() {
               if (!userToken || !userEmail) {
                 alert('Please sign in to create a debate.');
                 window.location.href = 'signin.html';
                 return;
               }
               
               createDebateModal.classList.add('active');
             });
           }
         })
         .catch(error => {
           console.error('Error loading debates:', error);
           
           debatesList.innerHTML = `
             <div class="col-span-full text-center py-12">
               <p class="text-red-500 mb-4">Error loading debates. Please try again later.</p>
               <button id="retry-load-debates-btn" class="px-6 py-3 border border-[#1f1d79] text-[#1f1d79] font-semibold rounded-md hover:bg-[#1f1d79] hover:text-white transition">Retry</button>
             </div>
           `;
           
           document.getElementById('retry-load-debates-btn').addEventListener('click', loadDebates);
         });
     }
     
     // Track if user is already in a debate
     let userInDebate = false;
     
     function openDebateView(debate) {
       // Check if user is already in another debate
       if (userInDebate && !debate.participants.some(p => p.email === userEmail)) {
         showError("You are already participating in another debate. Please leave that debate before joining a new one.");
         return;
       }
       
       // Set debate details
       document.getElementById('debate-view-title').textContent = debate.title;
       document.getElementById('debate-view-description').textContent = debate.description;
       document.getElementById('debate-view-council').textContent = debate.council;
       document.getElementById('debate-view-topic').textContent = debate.topic || 'General';
       
       // Set debate ID
       debateViewModal.setAttribute('data-debate-id', debate.id);
       
       // Set debate status
       const statusBadge = document.getElementById('debate-view-status');
       if (debate.status === 'active') {
         statusBadge.textContent = 'Active';
         statusBadge.className = 'ml-2 status-badge active';
       } else if (debate.status === 'completed') {
         statusBadge.textContent = 'Completed';
         statusBadge.className = 'ml-2 status-badge completed';
       } else if (debate.status === 'expired') {
         statusBadge.textContent = 'Expired';
         statusBadge.className = 'ml-2 status-badge expired';
       }
       
       // Initialize debate timer (35 minutes)
       initDebateTimer(35 * 60);
       
       // Render participants
       const participantsContainer = document.getElementById('debate-view-participants');
       
       if (debate.participants && debate.participants.length > 0) {
         participantsContainer.innerHTML = debate.participants.map(participant => {
           return `
             <div class="flex items-center space-x-2 bg-gray-100 rounded-full px-3 py-1">
               <img src="${participant.avatar || '/placeholder.svg'}" alt="${participant.name}" class="w-6 h-6 rounded-full">
               <span class="text-sm font-medium">${participant.username || participant.name}</span>
             </div>
           `;
         }).join('');
       } else {
         participantsContainer.innerHTML = `<p class="text-gray-500">No participants yet.</p>`;
       }
       
       // Check if user is already a participant
       const isParticipant = userEmail && debate.participants && debate.participants.some(p => p.email === userEmail);
       
       if (isParticipant) {
         // User is a participant, show chat section
         document.getElementById('debate-join-section').classList.add('hidden');
         document.getElementById('debate-chat-section').classList.remove('hidden');
         
         // Set userInDebate flag
         userInDebate = true;
         
         // Load chat messages
         loadChatMessages(debate.id);
         
         // Set up chat form
         setupChatForm(debate.id);
         
         // Check if user has access to AI features
         checkAIAccess();
         
         // Show voting section if there are at least 2 participants
         if (debate.participants.length >= 2) {
           setupVotingSection(debate);
         }
         
         // Set up leave debate button
         document.getElementById('leave-debate-btn').onclick = function() {
           leaveDebateConfirmModal.classList.add('active');
           
           // Set up confirm leave button
           document.getElementById('confirm-leave-btn').onclick = function() {
             leaveDebate(debate.id, false);
           };
           
           // Set up save and leave button
           document.getElementById('save-and-leave-btn').onclick = function() {
             leaveDebate(debate.id, true);
           };
         };
       } else {
         // User is not a participant, show join button
         document.getElementById('debate-join-section').classList.remove('hidden');
         document.getElementById('debate-chat-section').classList.add('hidden');
         document.getElementById('debate-voting-section').classList.add('hidden');
         
         // Set up join button
         const joinDebateBtn = document.getElementById('join-debate-btn');
         
         joinDebateBtn.onclick = function() {
           if (!userToken || !userEmail) {
             alert('Please sign in to join this debate.');
             window.location.href = 'signin.html';
             return;
           }
           
           // Check if user is already in another debate
           if (userInDebate) {
             showError("You are already participating in another debate. Please leave that debate before joining a new one.");
             return;
           }
           
           // Disable button
           joinDebateBtn.disabled = true;
           joinDebateBtn.innerHTML = '<span class="spinner inline-block mr-2"></span> Joining...';
           
           // Join debate
           fetch(`/api/debates/${debate.id}/join`, {
             method: 'POST',
             headers: {
               'Content-Type': 'application/json'
             },
             body: JSON.stringify({
               email: userEmail
             })
           })
           .then(res => res.json())
           .then(data => {
             if (data.success) {
               // Show chat section
               document.getElementById('debate-join-section').classList.add('hidden');
               document.getElementById('debate-chat-section').classList.remove('hidden');
               
               // Set userInDebate flag
               userInDebate = true;
               
               // Update participants
               if (!debate.participants) {
                 debate.participants = [];
               }
               
               debate.participants.push({
                 email: userEmail,
                 name: userName || userEmail,
                 username: userUsername,
                 avatar: userAvatar
               });
               
               // Re-render participants
               participantsContainer.innerHTML = debate.participants.map(participant => {
                 return `
                   <div class="flex items-center space-x-2 bg-gray-100 rounded-full px-3 py-1">
                     <img src="${participant.avatar || '/placeholder.svg'}" alt="${participant.name}" class="w-6 h-6 rounded-full">
                     <span class="text-sm font-medium">${participant.username || participant.name}</span>
                   </div>
                 `;
               }).join('');
               
               // Load chat messages
               loadChatMessages(debate.id);
               
               // Set up chat form
               setupChatForm(debate.id);
               
               // Check if user has access to AI features
               checkAIAccess();
               
               // Show voting section if there are at least 2 participants
               if (debate.participants.length >= 2) {
                 setupVotingSection(debate);
               }
               
               // Set up leave debate button
               document.getElementById('leave-debate-btn').onclick = function() {
                 leaveDebateConfirmModal.classList.add('active');
                 
                 // Set up confirm leave button
                 document.getElementById('confirm-leave-btn').onclick = function() {
                   leaveDebate(debate.id, false);
                 };
                 
                 // Set up save and leave button
                 document.getElementById('save-and-leave-btn').onclick = function() {
                   leaveDebate(debate.id, true);
                 };
               };
             } else {
               alert('Error: ' + (data.error || 'Failed to join debate'));
               
               // Re-enable button
               joinDebateBtn.disabled = false;
               joinDebateBtn.innerHTML = 'Join Debate';
             }
           })
           .catch(error => {
             console.error('Error joining debate:', error);
             alert('An error occurred. Please try again later.');
             
             // Re-enable button
             joinDebateBtn.disabled = false;
             joinDebateBtn.innerHTML = 'Join Debate';
           });
         };
       }
       
       // Show modal
       debateViewModal.classList.add('active');
     }
     
     // Function to leave a debate
     function leaveDebate(debateId, saveToProfile) {
       fetch(`/api/debates/${debateId}/leave`, {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           email: userEmail,
           saveToProfile: saveToProfile
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Reset userInDebate flag
           userInDebate = false;
           
           // Close modals
           leaveDebateConfirmModal.classList.remove('active');
           debateViewModal.classList.remove('active');
           
           // Clean up resources
           cleanupDebateResources();
           
           // Reload debates
           loadDebates();
           
           if (saveToProfile) {
             alert('Debate saved to your profile and left successfully.');
           } else {
             alert('You have left the debate.');
           }
         } else {
           alert('Error: ' + (data.error || 'Failed to leave debate'));
         }
       })
       .catch(error => {
         console.error('Error leaving debate:', error);
         alert('An error occurred. Please try again later.');
       });
     }
     
     // Initialize debate timer
     function initDebateTimer(seconds) {
       // Clear any existing timer
       if (window.debateTimer) {
         clearInterval(window.debateTimer);
       }
       
       const debateId = document.getElementById('debate-view-modal').getAttribute('data-debate-id');
       const timerElement = document.getElementById('debate-timer');
       
       // First, get the timer status from the server
       fetch(`/api/debates/${debateId}/timer`)
         .then(res => res.json())
         .then(data => {
           if (data.success) {
             let timeLeft;
             
             if (data.timerStarted) {
               // Timer has started, use the remaining time from server
               timeLeft = data.timeRemaining;
               startTimer(timeLeft, data.startTime); // Pass startTime to startTimer
             } else {
               // Timer hasn't started yet (waiting for second participant)
               timeLeft = seconds;
               timerElement.textContent = formatTime(timeLeft);
               
               // Check periodically if timer has started
               const checkTimerInterval = setInterval(() => {
                 fetch(`/api/debates/${debateId}/timer`)
                   .then(res => res.json())
                   .then(newData => {
                     if (newData.success && newData.timerStarted) {
                       // Timer has started, clear check interval and start the timer
                       clearInterval(checkTimerInterval);
                       startTimer(newData.timeRemaining, newData.startTime); // Pass startTime to startTimer
                     }
                   })
                   .catch(error => console.error('Error checking timer status:', error));
               }, 5000); // Check every 5 seconds
               
               // Store the check interval so we can clear it if needed
               window.timerCheckInterval = checkTimerInterval;
             }
           } else {
             // Fallback to local timer if server fails
             startTimer(seconds, null); // Pass null startTime
           }
         })
         .catch(error => {
           console.error('Error getting timer status:', error);
           // Fallback to local timer if server fails
           startTimer(seconds, null); // Pass null startTime
         });
       
       function startTimer(duration, startTime) {
         let timeLeft = duration;
         if (startTime) {
           const now = Date.now();
           const elapsedSeconds = Math.floor((now - new Date(startTime).getTime()) / 1000);
           timeLeft = Math.max(0, duration - elapsedSeconds);
         }
         updateTimerDisplay(timeLeft);
         
         // Start timer
         window.debateTimer = setInterval(() => {
           timeLeft--;
           updateTimerDisplay(timeLeft);
           
           // End debate when timer reaches 0
           if (timeLeft <= 0) {
             clearInterval(window.debateTimer);
             
             // Update status
             const statusBadge = document.getElementById('debate-view-status');
             statusBadge.textContent = 'Expired';
             statusBadge.className = 'ml-2 status-badge expired';
             
             // Show save debate option
             document.getElementById('save-debate-section').classList.remove('hidden');
             
             // Set up save debate button
             document.getElementById('save-debate-btn').onclick = function() {
               const debateId = document.getElementById('debate-view-modal').getAttribute('data-debate-id');
               saveDebateToProfile(debateId);
             };
             
             alert('The debate has ended. You can save it to your profile.');
           }
         }, 1000);
       }
       
       function updateTimerDisplay(seconds) {
         const minutes = Math.floor(seconds / 60);
         const secs = seconds % 60;
         timerElement.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
         
         // Add warning class when less than 5 minutes
         if (seconds <= 300 && seconds > 60) {
           timerElement.classList.add('warning');
           timerElement.classList.remove('danger');
         }
         // Add danger class when less than 1 minute
         else if (seconds <= 60) {
           timerElement.classList.add('danger');
           timerElement.classList.remove('warning');
         }
         else {
           timerElement.classList.remove('warning', 'danger');
         }
       }
       
       function formatTime(seconds) {
         const minutes = Math.floor(seconds / 60);
         const secs = seconds % 60;
         return `${minutes}:${secs.toString().padStart(2, '0')}`;
       }
     }
     
     function setupChatForm(debateId) {
       const chatForm = document.getElementById('chat-form');
       const chatInput = document.getElementById('chat-input');
       const sendButton = chatForm.querySelector('button[type="submit"]');
       
       // Reset form
       chatForm.reset();
       
       // Check if there are at least 2 participants
       fetch(`/api/debates/${debateId}`)
         .then(res => res.json())
         .then(data => {
           if (data.debate && data.debate.participants && data.debate.participants.length < 2) {
             // Disable chat form until second participant joins
             chatInput.disabled = true;
             sendButton.disabled = true;
             chatInput.placeholder = "Waiting for another participant to join...";
             
             // Check periodically for second participant
             const participantCheckInterval = setInterval(() => {
               fetch(`/api/debates/${debateId}`)
                 .then(res => res.json())
                 .then(newData => {
                   if (newData.debate && newData.debate.participants && newData.debate.participants.length >= 2) {
                     // Enable chat form when second participant joins
                     chatInput.disabled = false;
                     sendButton.disabled = false;
                     chatInput.placeholder = "Type your message...";
                     clearInterval(participantCheckInterval);
                   }
                 })
                 .catch(error => console.error('Error checking participants:', error));
             }, 5000); // Check every 5 seconds
           }
         })
         .catch(error => console.error('Error checking participants:', error));
       
       // Add typing indicator when user starts typing
       let typingTimeout;
       chatInput.addEventListener('input', function() {
         clearTimeout(typingTimeout);
         
         // Only send typing indicator if there's text
         if (chatInput.value.trim().length > 0) {
           // Send typing indicator via Pusher
           if (pusherInstance) {
             try {
               pusherInstance.trigger(`debate-${debateId}`, "user-typing", {
                 userId: localStorage.getItem('userId') || userEmail,
                 username: userUsername || userName || userEmail
               });
             } catch (error) {
               console.error('Error sending typing indicator:', error);
             }
           }
         }
         
         // Clear typing indicator after 2 seconds of no typing
         typingTimeout = setTimeout(() => {
           // Could send a "stopped typing" event here
         }, 2000);
       });
       
       // Set up form submission
       chatForm.onsubmit = function(e) {
         e.preventDefault();
         
         const content = chatInput.value.trim();
         
         if (!content) return;
         
         // Check for spam
         const now = Date.now();
         if (now - lastMessageTime < MESSAGE_COOLDOWN) {
           showError("Please wait a moment before sending another message.");
           return;
         }
         
         // Update last message time
         lastMessageTime = now;
         
         // Check for curse words
         if (containsCurseWords(content)) {
           showError("Please avoid using inappropriate language in your messages.");
           return;
         }
         
         // Clear input
         chatInput.value = '';
         
         // Create a temporary message element to show immediately
         const chatContainer = document.getElementById('debate-chat-container');
         const tempMessage = document.createElement('div');
         tempMessage.className = 'chat-message user';
         tempMessage.innerHTML = `
           <div class="flex items-center mb-1">
             <img src="${userAvatar || '/placeholder.svg'}" alt="${userName || userEmail}" class="w-5 h-5 rounded-full mr-2">
             <span class="text-xs font-medium">${userUsername || userName || userEmail}</span>
           </div>
           <p>${content}</p>
         `;
         chatContainer.appendChild(tempMessage);
         chatContainer.scrollTop = chatContainer.scrollHeight;
         
         // Send message
         fetch(`/api/debates/${debateId}/messages`, {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json'
           },
           body: JSON.stringify({
             email: userEmail,
             content
           })
         })
         .then(res => res.json())
         .then(data => {
           if (!data.success) {
             console.error('Error sending message:', data.error || 'Failed to send message');
             if (data.error === "You need at least 2 participants to start messaging") {
               showError("Waiting for another participant to join before you can send messages.");
             }
           }
         })
         .catch(error => {
           console.error('Error sending message:', error);
         });
       };
     }
     
     function loadChatMessages(debateId) {
       const chatContainer = document.getElementById('debate-chat-container');
       
       // Add a mutation observer to automatically scroll to the bottom when new messages are added
       const observer = new MutationObserver(function(mutations) {
         chatContainer.scrollTop = chatContainer.scrollHeight;
       });
       
       observer.observe(chatContainer, { childList: true });
       
       // Show loading indicator
       chatContainer.innerHTML = `
         <div class="flex justify-center items-center py-4">
           <div class="spinner"></div>
         </div>
       `;
       
       // Fetch messages
       fetch(`/api/debates/${debateId}/messages`)
         .then(res => res.json())
         .then(data => {
           if (data.messages && data.messages.length > 0) {
             chatContainer.innerHTML = '';
             
             // Render messages
             data.messages.forEach(message => {
               const isCurrentUser = message.email === userEmail;
               const messageClass = isCurrentUser ? 'user' : message.isAI ? 'ai' : 'other';
               
               const messageElement = document.createElement('div');
               messageElement.className = `chat-message ${messageClass}`;
               messageElement.innerHTML = `
                 <div class="flex items-center mb-1">
                   <img src="${message.avatar || '/placeholder.svg'}" alt="${message.name || 'User'}" class="w-5 h-5 rounded-full mr-2">
                   <span class="text-xs font-medium">${message.username || message.name || message.email}</span>
                   ${message.isAI ? '<span class="ml-1 text-xs bg-purple-100 text-purple-800 px-1 rounded">AI</span>' : ''}
                 </div>
                 <p>${message.content}</p>
               `;
               
               chatContainer.appendChild(messageElement);
             });
             
             // Scroll to bottom
             chatContainer.scrollTop = chatContainer.scrollHeight;
           } else {
             chatContainer.innerHTML = `
               <div class="text-center text-gray-500 py-4">
                 No messages yet. Be the first to contribute to this debate!
               </div>
             `;
           }
           
           // Set up Pusher for real-time updates
           setupPusher(debateId);
           
           // Set up auto-refresh for messages
           startMessageRefresh(debateId);
         })
         .catch(error => {
           console.error('Error loading messages:', error);
           chatContainer.innerHTML = `
             <div class="text-center text-red-500 py-4">
               Error loading messages. Please try again later.
               <button class="block mx-auto mt-2 px-4 py-2 border border-red-500 text-red-500 rounded-md hover:bg-red-500 hover:text-white transition" onclick="loadChatMessages('${debateId}')">Retry</button>
             </div>
           `;
         });
     }
     
     function startMessageRefresh(debateId) {
       // Clear any existing refresh interval
       if (window.messageRefreshInterval) {
         clearInterval(window.messageRefreshInterval);
         window.messageRefreshInterval = null;
       }
       
       // Set up new refresh interval (every 4 seconds)
       window.messageRefreshInterval = setInterval(() => {
         fetch(`/api/debates/${debateId}/messages`)
           .then(res => res.json())
           .then(data => {
             if (data.messages && data.messages.length > 0) {
               const chatContainer = document.getElementById('debate-chat-container');
               
               // Get existing message IDs
               const existingMessageIds = Array.from(chatContainer.querySelectorAll('.chat-message'))
                 .map(el => el.getAttribute('data-message-id'))
                 .filter(id => id); // Filter out null/undefined
               
               // Add only new messages
               data.messages.forEach(message => {
                 if (!existingMessageIds.includes(message.id)) {
                   const isCurrentUser = message.email === userEmail;
                   const messageClass = isCurrentUser ? 'user' : message.isAI ? 'ai' : 'other';
                   
                   const messageElement = document.createElement('div');
                   messageElement.className = `chat-message ${messageClass}`;
                   messageElement.setAttribute('data-message-id', message.id);
                   messageElement.innerHTML = `
                     <div class="flex items-center mb-1">
                       <img src="${message.avatar || '/placeholder.svg'}" alt="${message.name || 'User'}" class="w-5 h-5 rounded-full mr-2">
                       <span class="text-xs font-medium">${message.username || message.name || message.email}</span>
                       ${message.isAI ? '<span class="ml-1 text-xs bg-purple-100 text-purple-800 px-1 rounded">AI</span>' : ''}
                     </div>
                     <p>${message.content}</p>
                   `;
                   
                   chatContainer.appendChild(messageElement);
                   
                   // Scroll to bottom
                   chatContainer.scrollTop = chatContainer.scrollHeight;
                 }
               });
             }
           })
           .catch(error => console.error('Error refreshing messages:', error));
       }, 4000); // Refresh every 4 seconds
     }
     
     function cleanupDebateResources() {
       // Clear message refresh interval
       if (window.messageRefreshInterval) {
         clearInterval(window.messageRefreshInterval);
         window.messageRefreshInterval = null;
       }
       
       // Clear timer check interval
       if (window.timerCheckInterval) {
         clearInterval(window.timerCheckInterval);
         window.timerCheckInterval = null;
       }
       
       // Clear debate timer
       if (window.debateTimer) {
         clearInterval(window.debateTimer);
         window.debateTimer = null;
       }
     }
     
     function leaveDebate(debateId, saveToProfile) {
       fetch(`/api/debates/${debateId}/leave`, {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           email: userEmail,
           saveToProfile: saveToProfile
         })
       })
       .then(res => res.json())
       .then(data => {
         if (data.success) {
           // Reset userInDebate flag
           userInDebate = false;
           
           // Close modals
           leaveDebateConfirmModal.classList.remove('active');
           debateViewModal.classList.remove('active');
           
           // Clean up resources
           cleanupDebateResources();
           
           // Reload debates
           loadDebates();
           
           if (saveToProfile) {
             alert('Debate saved to your profile and left successfully.');
           } else {
             alert('You have left the debate.');
           }
         } else {
           alert('Error: ' + (data.error || 'Failed to leave debate'));
         }
       })
       .catch(error => {
         console.error('Error leaving debate:', error);
         alert('An error occurred. Please try again later.');
       });
     }
     
     // Listen for typing indicators
     if (pusherInstance) {
       const debateId = document.getElementById('debate-view-modal').getAttribute('data-debate-id');
       if (debateId) {
         const channel = pusherInstance.subscribe(`debate-${debateId}`);
         channel.bind('user-typing', function(data) {
           // Don't show typing indicator for current user
           if (data.userId !== localStorage.getItem('userId')) {
             showTypingIndicator(data.userId, data.username);
           }
         });
       }
     }
     
     // Function to show typing indicator
     function showTypingIndicator(userId, username) {
       const chatContainer = document.getElementById('debate-chat-container');
       
       // Check if typing indicator already exists
       if (document.getElementById(`typing-${userId}`)) return;
       
       const typingIndicator = document.createElement('div');
       typingIndicator.id = `typing-${userId}`;
       typingIndicator.className = 'typing-indicator text-xs text-gray-500 italic mb-2';
       typingIndicator.innerHTML = `${username} is typing<span>.</span><span>.</span><span>.</span>`;
       
       chatContainer.appendChild(typingIndicator);
       chatContainer.scrollTop = chatContainer.scrollHeight;
       
       // Remove after 3 seconds if no message is sent
       setTimeout(() => {
         const indicator = document.getElementById(`typing-${userId}`);
         if (indicator) indicator.remove();
       }, 3000);
     }
   });
 </script>
</body>
</html>
